#####################################################
# File is AUTO-GENERATED by {{ environ("USER") }}
# on {{ environ("CURRENT_DATE") }}.
#####################################################

{%- set wait = '! sleep 86400' %}

{%- if not (drive.numerator and drive.denominator) %}
Error: drive.numerator or drive.denominator not defined
{{ wait }}
{%- endif %}

{% if drive.numerator == 0 or drive.denominator ==0 %}
Error: drive.numerator or drive.denominator must be non zero.
{{ wait }}
{%- endif %}

{%- if not (encoder.numerator and encoder.denominator) %}
Error: encoder.numerator or encoder.denominator not defined
{{ wait }}
{%- endif %}

{% if encoder.numerator == 0 or encoder.denominator ==0 %}
Error: encoder.numerator or encoder.denominator must be non zero.
{{ wait }}
{%- endif %}

#- General
ecmcConfigOrDie "Cfg.CreateAxis({{axis.id}},1,{{drive.type or 0}})"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject({{details.health}},"ax{{axis.id}}.health")"
ecmcConfigOrDie "Cfg.SetAxisModRange({{axis.id}}, {{details.moduloRange}})"
ecmcConfigOrDie "Cfg.SetAxisModType({{axis.id}}, {{details.moduloType}})"

#-Drive
ecmcConfigOrDie "Cfg.LinkEcEntryToObject({{drive.control}},"ax{{axis.id}}.drv.control")"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject({{drive.status}},"ax{{axis.id}}.drv.status")"
{%- if axis.mode == 'CSV' %}
ecmcConfigOrDie "Cfg.LinkEcEntryToObject({{drive.setpoint}},"ax{{axis.id}}.drv.velocity")"
{%- else %}
ecmcConfigOrDie "Cfg.LinkEcEntryToObject({{drive.setpoint}},"ax{{axis.id}}.drv.position")"
{%- endif %}

#- Encoder
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom({{axis.id}},{{encoder.denominator}})"
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum({{axis.id}},{{encoder.numerator}})"
ecmcConfigOrDie "Cfg.SetAxisEncType({{axis.id}},{{encoder.type}})"
ecmcConfigOrDie "Cfg.SetAxisEncBits({{axis.id}},{{encoder.bits}})"
ecmcConfigOrDie "Cfg.LinkEcEntryToObject({{encoder.position}},"ax{{axis.id}}.enc.actpos")"
